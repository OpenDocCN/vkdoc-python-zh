# 一、在开始之前

设计模式帮助你从别人的成功中学习，而不是从自己的失败中学习。—马克·约翰逊

世界正在改变。

当你读这篇文章的时候，全世界的人都在学习编程，但大多很糟糕。大量的“程序员”涌向市场，你无法阻止他们。和所有的事情一样，你很快就会看到，随着程序员供给的增加，雇佣程序员的成本会降低。简单地写几行代码或改变一个软件的某些东西(就像电子表格或文字处理大师的角色)将成为一项基本技能。

如果你打算以程序员为生，这个问题会因互联网而变得更糟。你不仅要担心你所在地区的程序员，还要担心来自世界各地的程序员。

你知道谁不担心像蘑菇一样涌现的数百个代码训练营产生的数百万程序员吗？

## 大师们

虽然每个人都可以写作，但世界上仍然有不同的写作方式。虽然每个人都可以使用 Excel，但是仍然有财务建模者。当每个人都能编码时，世界上仍然会有彼得·诺维格斯。

编程是一种工具。有一段时间，仅仅知道如何使用这个工具就让你变得有价值。那个时代已经结束了。这是一个新的现实，也是许多行业多年来不得不面对的现实。当一个工具是新的，没有人想使用它。然后，一些人看到了价值，这使他们比那些不会使用工具的人好两倍。然后，就流行起来了。不知不觉中，每个人都可以使用互联网。突然间，能够创建一个网站变得没有价值了。所有提供咨询、收取高额服务费的企业都被边缘化了。然而，无论市场发生什么，花时间掌握工具的人都能茁壮成长。他们能够做到这一点，是因为他们能够在各个层面上超越普通人——工作质量、开发速度和最终结果的美感。

现在，我们看到了大众对简单事物的理解。下一步将是把容易的事情自动化。在生活的每个领域，简单的任务之所以简单，是因为它们不需要创造力和深刻的理解，由于这些特点，它们正是将首先交给计算机的任务。

你拿起这本书的原因是因为你想成为一名更好的程序员。你想要超越成千上万的对这个和那个的介绍。你已经准备好迈出下一步，去掌握这门手艺。

在编程的新世界中，你希望能够解决大而复杂的问题。要做到这一点，你需要能够在更高的层面上思考。就像国际象棋大师一样，他们能以比大师更大的块来消化游戏，你也需要发展以更大的块来解决问题的技能。当你能够看待一个全新的问题，并迅速将其分解成高层次的部分，即你以前已经解决过的部分，你就成为了一个指数程序员。

当我开始编程时，我还看不懂手册。封面上有一张太空入侵者的图片，它承诺教你如何自己编写一个游戏。这有点吵闹，因为游戏最终是一个`for`循环和一个`if`声明，而不是太空入侵者。但是我恋爱了。激情驱使我尽我所能学习编程的一切，这并不多。在掌握了基础知识之后，我停滞不前了，甚至在获得计算机科学学士学位时也是如此。我觉得我所学的只是基础知识的简单重复。我确实学了，但感觉很慢，令人沮丧，好像每个人都在等待什么。

在“真实世界”中，它看起来并没有太大的不同。我开始意识到，如果我想成为一名指数程序员，我必须做一些不同的事情。起初，我想过拿个硕士或博士学位，但最后我决定自己深挖。

我重读了旧的计算理论书籍，它们获得了新的意义和新的生命。我开始定期参加编码挑战，并学习更多编写代码的惯用方法。然后，我开始探索与我自己不同的编程语言和范式。不知不觉中，我对编程的思维已经完全转变了。过去很难的问题变得微不足道，一些看起来不可能的事情变得仅仅是挑战。

我还在学习，还在挖掘。

你也能做到。从你现在正在读的这本书开始。在这本书中，你会发现许多工具和心智模型可以帮助你更好地思考和编码。在你掌握了这套模式之后，积极寻找并掌握不同的工具和技术。尝试不同的框架和语言，找出它们的优点。一旦你能理解是什么让一个人喜欢上一种不同于你经常使用的语言，你可能会发现其中的一些想法可以融入你的思维方式。研究你在任何地方发现的食谱和模式，并把它们转化成你可以反复使用的抽象解决方案。有时候，你可以简单地分析一个你已经使用的解决方案:你能找到一个更优雅的方法来实现这个想法吗，或者这个想法在某些方面有缺陷吗？不断地问自己如何改进你的工具，你的技能，或者你自己。

如果你准备深入挖掘并掌握这门艺术，你会在这本书里找到指导你走向精通之路的想法。我们将在现实环境中探索一套基本的设计模式。当你这样做的时候，你将开始意识到这些设计模式是如何被看作是你将来遇到特定类型的问题时可以使用的构建模块。

我的希望是，你将使用本书中的设计模式作为蓝图；这将帮助你开始收集你自己的问题解决方案。在你读完这本书之后，你应该已经踏上了通往下一个级别的程序员之旅。您还应该了解如何将这组抽象工具翻译成您可能遇到的任何编程语言，以及如何使用其他语言中的思想和解决方案并将其纳入您的思维工具箱。

## 成为更好的程序员

要成为一名更好的程序员，你需要决定痴迷于精通。每一天都是一个新的机会，让你变得比前一天更好。每一行代码都是改进的机会。你是怎么做到的？

*   当您必须在一段现有代码上工作时，让代码比您发现它时更好。
*   尝试每天完成一个快速解决问题的挑战。
*   寻找机会与比你更优秀的程序员一起工作(开源项目非常适合这一点)。
*   专注于刻意练习。
*   只要你能找到借口，就练习系统思考。
*   收集和分析心智模型。
*   掌握你的工具，明白它们有什么用途，不应该用来做什么。

### 刻意练习

安德斯·埃里克森博士研究了那些达到了我们称之为精通的表现水平的人。他发现这些人有几个共同点。第一，正如马尔科姆·格拉德威尔的书《局外人》中所流行的，这些人似乎都花了大量的时间在所讨论的技能上。实际数字各不相同，但投入的时间接近 10，000 小时。这是一段很长的时间，但是仅仅花 10，000 个小时或者 10 年来练习是不够的。有一种非常特殊的练习被证明是大师级演奏所必需的。主宰世界的技巧的关键是有意识的练习。

我们一会儿会看看这与编程有什么关系，但是让我们先看看什么是刻意练习。

刻意的练习是缓慢的、停顿的、逆流的。如果你在练习小提琴，刻意的练习需要非常缓慢地演奏这首曲子，确保你完美地弹奏每一个音符。如果你有意练习网球，这可能意味着在教练的指导下一遍又一遍地做同样的击球，做一些小的调整，直到你能够一次又一次地在那个位置完美地击球。

知识工作的问题在于，标准的刻意练习协议似乎是外来的。与编程中涉及的过程相比，一项体育任务或演奏一种乐器是相当简单的。解构设计和开发软件解决方案的过程要困难得多。很难弄清楚如何实践一种思维方式。其中一个原因是，一个已解决的问题倾向于保持解决状态。我的意思是，作为一个开发者，你很少会被要求去写一个已经写好的软件。找到反复练习的“镜头”很难。

在编程中，你想学习解决问题的不同方法。你希望找到不同的挑战，迫使你用不同的约束来解决同一类型的问题。继续努力，直到你彻底理解问题和可能的解决方案。

本质上，刻意练习有以下几个组成部分:

*   每次练习都有一个重点。
*   尝试和反馈之间的距离(时间)越短越好。
*   做一些你还不能做的事情。
*   追随前人的足迹。

### 单焦点

在一次特定的训练中，你只想专注于一件事的原因是，你想把你所有的注意力都放在你希望提高的元素上。你想尽一切努力把它做得完美，哪怕只有一次。然后，你想重复这个过程来得到另一个完美的回答，然后是另一个。每次练习都是对技能的一次强化。你想要强化导致完美结果的模式，而不是那些不太理想的结果。

在这本书的上下文中，我希望你一次只针对一个设计模式。真正寻求理解的不仅仅是模式是如何工作的，还有它最初为什么被使用，以及它如何应用于手头的问题。此外，考虑使用这种设计模式可能能够解决的其他问题。接下来，尝试使用您正在处理的模式来解决其中的一些问题。

你想为问题和解决问题的模式创建一个心理盒子。理想的情况是，你会发展出一种感觉，知道什么时候问题可以放进你已经掌握的盒子里，然后能够快速而容易地解决问题。

### 快速反馈

经常被忽视的有意识的练习之一是快速反馈循环。反馈越快，联系越强，你就越容易从中学习。这就是为什么像营销和写作这样的东西如此难以掌握。从把信放在纸上到从市场得到反馈之间的时间太长了，以至于无法真正看到实验的效果。对于编程来说，情况并非如此；您可以编写一段代码，然后运行它以获得即时反馈。这使你能够正确处理并最终达成一个可接受的解决方案。如果您更进一步，为您的代码编写可靠的测试，您将获得更多的反馈，并且您能够比每次做出更改都必须手动测试过程更快地找到解决方案。

帮助你更快地从这个过程中学习的另一个技巧是预测你想写的代码块的结果。记下你为什么期望这个特定的结果。现在编写代码，并对照预期结果检查结果。如果不匹配，尝试解释为什么会出现这种情况，以及如何用另一段代码来验证您的解释。然后，测试一下。坚持做下去，直到你掌握为止。

你会发现自己得到了不同层次的反馈，每一个层次都有自己的优点。

第一个层次就是解决方案是否有效。接下来，您可能会开始考虑诸如“该解决方案实施起来有多容易？”或者“这个解决方案适合这个问题吗？”稍后，您可能会寻求外部反馈，其形式可以是简单的代码审查、项目工作或与志同道合的人讨论解决方案。

### 伸展你自己

你回避的事情是什么？这些是编程中让你感到不舒服的地方。它可能是从磁盘上的文件中读取或者连接到远程 API。无论是图形库还是机器学习系统都没有区别，我们都有不舒服的地方。这些通常是你最需要努力的事情。这里有一些领域会拓展你，迫使你面对自己的弱点和盲点。克服这种不适的唯一方法是深入其中，以多种方式多次使用这个工具，这样你就能开始对它有感觉了。您必须对它非常熟悉，这样您就不必再在堆栈溢出时查找文件打开协议；事实上，你写了一个更好的。你用 GUI 跳绳，一只手绑在背后从数据库中吸取数据。

达到这种精通水平没有捷径；唯一的路是穿过这座山。这就是为什么很少有人成为真正的大师。到达那里意味着花很多时间在不容易的事情上，这不会让你觉得你是不可战胜的。你花了太多时间在这些自我毁灭的地带，以至于很少有任何一门手艺的大师还留有许多傲慢。

那么，你应该先做什么呢？你读前面两段时想到的那件事。

按照本书中的设计模式工作是发现潜在增长领域的另一个好方法。只需从单例模式开始，然后一步步来。

### 站在巨人的肩膀上

有些人在编程领域做出了惊人的成就。这些人经常在开发者大会上发表演讲，有时也会出现在网上。看看这些人在说什么。试着理解他们是如何处理一个新问题的。在他们演示解决方案时，和他们一起打字。进入他们的大脑，找出是什么让他们跳动。试着解决一个问题，就像你想象他们中的一个会做的那样；你用这种方式想出的解决方案和你自己想出的有什么不同？

真正伟大的开发人员对编程充满热情，不需要太多的刺激就能让他们谈论技术的细节。找出这类开发人员经常出没的用户群，并展开大量对话。保持开放，不断学习。

选择那些强迫你使用你尚未掌握的设计模式的个人项目。好好享受吧。最重要的是，学会热爱这个过程，不要沉迷于一些可感知的结果，而不是花时间成为一名更好的程序员。

### 你是怎么做到的？

就像列奥纳多·达·芬奇决定以绘画为职业时那样开始。

收到。

没错。首先确定一些有趣的问题，一个已经解决的问题，然后公然复制解决方案。不要复制/粘贴。自己打出来复制解答。让您的副本发挥作用。一旦你做了，全部删除。现在试着从记忆中解决问题，当你的记忆让你失望时，只参考最初的解决方案。这样做，直到您能够在不看原始解决方案的情况下，完美地重现解决方案。如果你在寻找可以复制和借鉴的问题解决方案，Github 就是一座金矿。

一旦你对你找到的解决方案感到满意，试着改进最初的解决方案。你需要学会思考你在那里找到的解决方案——是什么让它们变得好？如何让它们更优雅、更地道、更简单？总是寻找机会以这些方式中的一种使代码变得更好。

接下来，你想把你的新解决方案带到野外。找到使用解决方案的地方。在现实世界中练习迫使你处理不同的约束，那种你自己永远不会想到的约束。它会迫使你以从未想过的方式改变你漂亮、干净的解决方案。有时候，你的代码会崩溃，你会学会欣赏最初解决问题的方式。其他时候，你可能会发现你的解决方案比原来的更好。问问你自己，为什么一个解决方案优于另一个，这个问题和解决方案教会了你什么。

尝试使用不同范式的语言来解决类似的问题，从每种语言中吸取经验，然后自己形成解决方案。如果你像实际解决问题一样关注过程，没有项目会让你置身事外。

从事开源项目的美妙之处在于，通常会有一些人会帮助你，还有一些人会告诉你你的代码到底出了什么问题。评估他们的反馈，学习你所能学到的，抛弃其他的。

### 航向修正的能力

当探索一个问题时，你有两个选择:继续这样尝试，或者放弃一切，用我学到的重新开始。丹尼尔·卡纳曼在他的《思考，快与慢》一书中解释了沉没成本谬误。这是你继续投资于一个糟糕的投资的地方，因为你已经投资了这么多。这对于一个开发者来说是一个致命的陷阱。让一个两天的项目花上几个月的最快方法是尝试通过一个糟糕的解决方案。如果我们放弃一天、一周或一个月的工作，从零开始，这通常会是一个巨大的损失。

事实是，我们从来没有从零开始，有时您删除的最后 10，000 行代码正是您需要编写的 10，000 行代码，您需要成为一名程序员，用 100 行代码用一个惊人的优雅解决方案解决问题。

你需要培养意志，说够了就够了，然后重新开始，用你所学到的建立一个新的解决方案。

如果一个解决方案是错误的，那么在这个解决方案上花费的时间再多也没有任何意义。你越早意识到这一点越好。

这种自我意识让你有能力知道什么时候再尝试一件事，什么时候朝不同的方向前进。

## 系统思维

一切都是一个系统。通过理解什么元素组成了系统，它们是如何连接的，以及它们如何相互作用，你就能理解这个系统。通过学习解构和理解系统，你不可避免地教会了自己如何设计和构建系统。每一个软件都表达了这三个核心组件:组成解决方案的元素，以及它们之间的一组连接和交互。

在一个非常基础的层面上，你可以从问你自己开始:“我想要建立的系统的元素是什么？”把这些写下来。然后，写下它们是如何相互联系的。最后，列出这些元素之间的所有相互作用以及起作用的联系。这样做，你就完成了系统的设计。

所有设计模式都处理这三个基本问题:1)元素是什么，它们是如何创建的？2)元素之间有什么联系，或者说结构是什么样子的？3)元素如何交互，或者它们的行为看起来像什么？

还有其他方法来分类设计模式，但是现在使用经典的三个分组来帮助你发展你的系统思维技能。

## 心理模型

心理模型是外部世界的内在表现。你对世界的模型越精确，你的思维就越有效。地图不是领域，所以拥有更准确的心智模型会让你对世界的看法更准确，你的心智模型越多才多艺，你就能解决越多种多样的问题。在本书中，你将学到一套思维工具，帮助你解决在你的程序员生涯中经常遇到的特定编程问题。

看待心智模型的另一种方式是将它们视为一组概念，组成一个单一的思维单元。设计模式的研究将帮助你开发新的思维模式。一个问题的结构将暗示你需要实现什么样的解决方案来解决这个问题。这就是为什么你要完全清楚你要解决的问题是什么是很重要的。问题定义或描述越好——我的意思是越完整——你对可能的解决方案的暗示就越多。所以，就这个问题问自己一些愚蠢的问题，直到你有了一个清晰简单的问题陈述。

设计模式帮助你从 A(问题陈述)到 C(解决方案),而不必经过 B 和许多其他错误的开始。

## 适合这项工作的工具

要打破砖墙，你需要一把锤子，但不是随便一把——你需要一把又大又重的长柄锤子。当然，你可以用你用来在音乐盒里钉钉子的那把锤子砸开这面墙，但是用合适的工具敲一个下午的时间，却要花上你好几辈子的时间。

使用错误的工具，任何工作都会变得一团糟，花费的时间也会比预期的长。为这项工作选择合适的工具是一个经验问题。如果你不知道除了你习惯的小锤子还有锤子，你很难想象有人能在几个小时内推倒整面墙。你甚至可以称这样的人为 10 倍破壁人。我想说的是，有了合适的工具，你将能够比那些试图用现有资源凑合的人多做许多倍的工作。花时间和精力扩展你的工具箱，掌握不同的工具是值得的，这样当你遇到一个新问题时，你就知道选择哪一个。

要成为一名编程大师，你需要不断地向你的武器库中添加新的工具，不仅仅是熟悉它们，而是掌握它们。我们已经看了掌握您决定的工具的过程，但是在 Python 的环境中，让我提出一些具体的建议。

Python 生态系统的一些美妙之处是可以直接获得的包。有很多包，但通常你可能遇到的每种类型的问题都有一个或两个明确的领导者。这些包是有价值的工具，您应该每周花几个小时来研究它们。一旦你掌握了本书中的模式，抓住 Numpy 或 Scipy 并掌握它们。然后，向你想象的任何方向前进。下载您感兴趣的包，学习基础知识，然后开始使用已经提到的框架进行试验。它们闪耀在哪里，又缺少了什么？他们特别擅长解决什么样的问题？你将来如何使用它们？你能做什么样的辅助项目来让你在现实世界的场景中尝试这个包？

## 作为概念的设计模式

四人帮关于设计模式的书似乎是一切开始的地方。他们提出了一个描述设计模式的框架(特别是针对 C++ ),但是描述通常集中在解决方案上，结果许多模式被翻译成多种语言。该书中列出的 23 种设计模式的目标是为面向对象编程中遇到的常见问题编写最佳实践解决方案。因此，解决方案关注于类及其方法和属性。

这些设计模式每一个都代表一个完整的解决方案，它们将变化的东西与不变的东西分开。

有许多人对最初的设计模式持批评态度。其中一位批评家 Peter Norvig 展示了如何用 Lisp 中的语言结构来代替其中的 16 种模式。这些替换在 Python 中也是可能的。

在这本书里，我们将会看到几个原始的设计模式，以及它们如何适应现实世界的项目。我们还将在 Python 语言的上下文中考虑关于它们的争论，有时为了使用该语言的标准解决方案而放弃该模式，有时改变 GoF 解决方案以利用 Python 的强大功能和表达能力，而其他时候只是以 Python 的方式实现原始解决方案。

### 什么构成了设计模式？

设计模式可以是很多东西，但它们都包含以下元素(鸣谢:彼得·诺维格， [`http://norvig.com/design-patterns/ppframe.htm`](http://norvig.com/design-patterns/ppframe.htm) ):

*   模式名称
*   意图/目的
*   别名
*   动机/背景
*   问题
*   解决办法
*   结构
*   参与者
*   协作
*   后果/限制
*   履行
*   示例代码
*   已知用途
*   相关模式

在附录 A 中，您可以找到我们在本书中讨论的所有设计模式都是根据这些元素构建的。出于可读性和学习过程的考虑，关于设计模式本身的章节不会都遵循这种结构。

### 分类

设计模式被分为不同的组，以帮助我们作为程序员彼此谈论解决方案的类别，并在讨论这些解决方案时给我们一个共同的语言。这使我们能够清晰地交流，并在讨论中表达我们的主题。

正如本章前面提到的，我们将根据创造、结构和行为模式的原始分组来对设计模式进行分类。这样做不仅是为了坚持一般的做事方式，也是为了帮助你，读者，在他们所处的系统环境中查看模式。

#### 创造型的

第一类处理系统中的元素——特别是它们是如何被创建的。当我们处理面向对象编程时，对象的创建是通过类实例化来实现的。正如您将很快看到的，在解决特定问题时，有不同的特性是可取的，而创建对象的方式对这些特性有重大影响。

#### 结构的

结构模式处理类和对象是如何组成的。可以使用继承来组合对象，以获得新的功能。

#### 行为的

这些设计模式专注于对象之间的交互。

## 我们将使用的工具

世界正在向 Python 3 转变。这种转变是缓慢而深思熟虑的，就像冰川一样，无法停止。为了这本书，我们将发布 Python 2，拥抱未来。也就是说，您应该能够毫不费力地使用 Python 2 编写大部分代码(这并不是因为书中的代码，而是 Python 核心开发人员出色工作的结果)。

对于 Python，特别是 CPython(默认的)，您可以使用 Pip，Python 包安装程序。Pip 与 PyPI(Python 包索引)集成，允许您从包索引下载和安装包，而无需手动下载包、解压缩包、运行 python setup.py install 等。Pip 让为您的环境安装库成为一种乐趣。Pip 还为您处理所有的依赖项，因此没有必要在您尚未安装所需的软件包后到处跑。

当你开始着手第三个项目时，你会需要很多包。并非所有的项目都需要这些包。您将希望保持每个项目的包都被很好地包含。进入 VirtualEnv，这是一个虚拟的 Python 解释器，它将为该解释器安装的包与系统上的其他包隔离开来。您可以将每个项目放在自己的极简空间中，只安装它工作所需的包，而不会干扰您可能正在进行的其他项目。

## 如何阅读这本书

阅读一本书的方法有很多，尤其是编程书。大多数人在开始读这本书的时候都希望能从头到尾读一遍，结果只是从一个代码示例跳到另一个代码示例。我们都做过。记住这一点，你可以通过多种方式阅读这本书，并从花在这本书上的时间中获得最佳价值。

第一批读者只想快速、可靠地参考 GoF 设计模式的 pythonic 版本。如果这是你，请跳到附录 A，查看每个设计模式的正式定义。当你有时间的时候，你可以回到相关的章节，继续探索你感兴趣的设计模式。

第二类人希望能够找到具体问题的具体解决方案。对于那些读者来说，每一章的设计模式都是从描述模式所解决的问题开始的。这将有助于您决定该模式是否有助于解决您所面临的问题。

最后一组想用这本书来掌握自己的手艺。对于这些读者，我建议你从头开始，通过你的方式编写这本书。把每个例子都打出来。修补每一个解决方案。做所有的练习。看看修改代码后会发生什么。什么东西坏了，为什么？让解决方案更好。一次处理一个模式，并掌握它。然后，找到其他你可以应用新知识的真实环境。

## 设置 Python 环境

让我们从让 Python 3 环境在您的机器上运行开始。在这一节中，我们将研究在 Linux、Mac 和 Windows 上安装 Python 3。

### 在 Linux 上

我们使用的命令是针对 Ubuntu 的 apt 包管理器。对于其他不支持 apt 的发行版，可以看看使用另一个包管理器(比如 yum)安装 Python 3 和`pip`的过程，或者从源代码安装相关的包。

整个安装过程都将使用终端，所以您现在可以开始打开它了。

让我们首先检查您的系统上是否已经安装了 Python 的一个版本。

只需注意:在本书的持续时间内，我将用前导`$`来表示终端命令；在终端中输入注释时，不要键入该字符或后续空格。

```py
$ python --version

```

如果您已经安装了 Python 3(Ubuntu 16.04 和更高版本就是这种情况)，您可以直接跳到安装 pip 一节。

如果您的系统上安装了 Python 2 或者没有安装 Python，您可以使用以下命令安装 Python 3:

```py
$ sudo apt-get install python3-dev

```

这将安装 Python 3。您可以像以前一样检查 Python 安装的版本，以验证是否安装了正确的版本:

```py
$ python3 --version

```

Python 3 现在应该可以在您的系统上使用了。

接下来，我们安装 build essentials 和 Python `pip:`

```py
$ sudo apt-get install python-pip build-essential

```

现在，检查`pip`是否正常工作:

```py
$ pip --version

```

您应该看到您的系统上安装了一个版本的`pip`，现在您已经准备好安装`virtualenv`包了；请跳过 Mac 和 Windows 安装说明。

### 在 Mac 上

macOS 默认安装了 Python 2 版本，但是我们不需要它。

为了安装 Python 3，我们将使用 Homebrew，这是一个用于 macOS 的命令行包管理器。要做到这一点，我们需要 Xcode，你可以从 Mac AppStore 免费获得。

安装 Xcode 后，打开“终端”应用并安装 Xcode 的命令行工具:

```py
$ xcode-select --install

```

只需按照弹出窗口中的提示安装 Xcode 的命令行工具。完成后，您就可以安装自制软件了:

```py
$ ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

```

如果您还没有安装 XQuartz，您的 macOS 可能会遇到一些错误。如果出现这种情况，可以在这里下载 XQuartz`.dmg`:[`https://www.xquartz.org/`](https://www.xquartz.org/)。然后，检查您是否成功安装了 Homebrew 并且它正在工作:

```py
$ brew doctor

```

要从终端中的任何文件夹运行`brew`命令，需要将 Homebrew 路径添加到您的`PATH`环境变量中。打开或创建`~/.bash_profile`,并在文件末尾添加以下行:

```py
export PATH=/usr/local/bin:$PATH

```

关闭并重新打开终端。重新打开后，新的`PATH`变量将包含在环境中，现在您可以从任何地方调用`brew`。使用`brew`查找 Python 可用的包:

```py
brew search python

```

您现在将看到所有与 Python 相关的包，`python3`是其中之一。现在，使用下面的`brew`命令安装 Python 3:

```py
$ brew install python3

```

最后，您可以检查 Python 3 是否已安装并正在运行:

```py
python3 --version

```

当你用 Homebrew 安装 Python 的时候，你也安装了相应的包管理器(`pip`)、Setuptools 和 pyvenv(一个`virtualenv`的替代品，但是对于这本书你只需要`pip`)。

检查 pip 是否正常工作:

```py
$ pip --version

```

如果看到版本信息，说明`pip`已经成功安装在您的系统上，您可以跳过 Windows 安装部分，跳到使用`pip`安装 VirtualEnv 的部分。

### 在窗口上

首先下载 Python 3 Windows 安装程序。你可以在这里下载安装程序: [`https://www.python.org/`](https://www.python.org/) 。

下载完成后，运行安装程序并选择自定义选项。确保选择安装 pip。此外，选择将 Python 添加到环境变量的选项。

随着安装，你也变得空闲，这是一个交互式 Python shell。这使您可以在实时解释器中运行 Python 命令，这对于测试想法或试验新的包来说是非常好的。

安装完成后，打开命令行界面:

```py
windowsbutton-r
cmd

```

这将打开一个类似于 Mac 和 Linux 上可用的终端。

现在，检查 Python 是否在工作:

```py
$ python --version

```

如果您看到版本信息，Python 已安装并链接到该路径，这是应该的。

在我们继续之前，检查一下`pip`是否在工作:

```py
$ pip --version

```

### VirtualEnv(虚拟环境)

在开始安装 VirtualEnv 之前，让我们确保已经安装了最新版本的`pip`:

```py
$ pip install --upgrade pip

```

Windows 用户将看到如下命令提示符:

```py
c:\some\directory>

```

在 Mac 上你有

```py
#

```

在 Linux 上是这样的

```py
$

```

在本书中，我将使用`$`来表示终端命令。

使用`pip`安装`virtualenv`包:

```py
$ pip install virtualenv

```

现在您已经有了`virtualenv`包，让我们用它来创建一个使用这本书的环境。

在您的终端中，转到您将工作的目录。接下来，创建一个虚拟环境，您将在其中安装本书中的项目所需的包。我们的虚拟环境将被称为`ppdpenv;``env`只是为了让我们知道它是一个虚拟环境。每当我们激活这个环境并使用`pip`命令安装一个新的包时，这个新的包将只安装在这个环境中，并且只在这个环境激活时对程序可用。

```py
$ virtualenv -p python3 ppdpenv

```

在 Windows 上，您需要一个稍微不同的命令:

```py
$ virtualenv -p python ppdpenv

```

如果 Python 3 不是您的`PATH`的一部分，您可以使用您想要在您的`virtualenv`中使用的 Python 可执行文件的完整路径。

安装过程结束后，您将在运行`virtualenv`命令时所在的目录中拥有一个名为`ppdpenv`的新目录。

要激活虚拟环境，请在 Mac 和 Linux 上运行以下命令:

```py
$ source ./ppdpenv/bin/activate

```

在 Windows 上:

```py
$ source ppdpenv\Scripts\activate

```

最后，检查 Python 的版本，确保安装了正确的版本。

就这样——您已经准备好用 Python 编程了！

要退出虚拟环境，您可以运行以下命令:

```py
$ deactivate

```

## 编辑

任何可以保存纯文本文件的文本编辑器都可以用来编写 Python 程序。除了记事本，你可以什么都不用写下一个优步，但这会很痛苦。每当你写一个任意长度的程序时，你需要一个编辑器来突出你的代码，用不同的颜色标记不同的关键字和表达式，这样你就可以很容易的区分它们。

以下是我最喜欢的文本编辑器的简短列表，每个都有一些注释。

### 原子

Github 开发了一个编辑器，他们称之为 Atom，它是一个简单、漂亮、功能强大的编辑器。它提供了简单的 git 集成和良好的包系统(包括一个实时的 markdown 编译器)。事实上，它是基于电子的，这意味着无论你想在什么平台上工作，你都可以随身携带你的编辑器。如果它能运行 Chromium，它就会运行 Atom。

拿到这里: [`https://atom.io/`](https://atom.io/) 。

### 看版台

这款基于 ClojureScript(一种编译成 JavaScript 的 Lisp 方言)，有 Vim 和 Emacs 两种模式，所以你可以把自己从鼠标中解放出来。像大多数现代代码编辑器一样，LightTable 也提供了直接的 git 集成。它是开源的，易于定制。

拿到这里: [`http://lighttable.com/`](http://lighttable.com/) 。

### PyCharm

Jetbrains 为 Python 编辑器制定了行业标准。它提供了很棒的代码补全、Python linter、未使用的导入警告等等，但对我来说，它的致命特性是代码拼写检查，它同时考虑了 Camel 和 Snake 两种情况。

PyCharm 的企业版并不便宜，但他们提供免费的学生和社区许可证。

拿到这里: [`https://www.jetbrains.com/pycharm/download`](https://www.jetbrains.com/pycharm/download) 。

### 精力

大多数基于 UNIX 的操作系统都已经安装了 Vim。Vim 有时被称为你无法摆脱的编辑器(提示:“`:q!`”让你摆脱)。Vim 最强大的地方在于它的快捷键可以做任何事情，从选择代码块到跳转到代码中的特定行——任何事情都不需要离开键盘。多年来，Vim 积累了大量的扩展、颜色主题和一个成熟的 IDE 梦寐以求的所有特性。它有自己的包管理器，让你完全控制代码编辑的每一个方面。它是免费的，是我见过的所有编辑器中最快的。尽管 Vim 有很多优点，但它很难学——非常难。每当我想写一个快速脚本或者做一些小的改变，并且不想等待其他编辑器/IDE 启动时，我都会使用 Vim。

通过这里设置 Python 的 Vim:[`https://realpython.com/blog/python/vim-and-python-a-match-made-in-heaven/`](https://realpython.com/blog/python/vim-and-python-a-match-made-in-heaven/)。

### 编辑器

令人惊叹的操作系统；如果它有一个好的文本编辑器就好了。Emacs 是建立在 Emacs Lisp 之上的，并且是可定制的。你可以用它做任何事情，从发送电子邮件到启动咖啡机，只需一个简单的快捷键组合。像 Vim 一样，它是无鼠标的，但是它有一个更陡峭的学习曲线。那些了解内情的人对此深信不疑，而且理由充分。您拥有现代 IDE 提供的所有代码完成和分屏选项，并且能够在需要时调整系统。您不必等待某个供应商创建一个包来处理一些新语言特性；你可以自己轻松搞定。Easily 用得很不严谨。有了 Emacs，你可以让你的编辑按照你认为应该做的方式去做事情，而编程的很大一部分是因为对目前做事情的方式不满意，而采取不同的方式。

通过阅读以下内容为 Python 开发设置 Emacs:[`https://realpython.com/blog/python/emacs-the-best-python-editor/`](https://realpython.com/blog/python/emacs-the-best-python-editor/)。

### 崇高的文本

这与其说是一个真正的建议，不如说是一个荣誉的提及。Sublime 曾经是最好的免费选项(每隔几个救球就有 nag 屏幕)。它有一个漂亮的默认配色方案，启动相当快，并且是可扩展的。它是 Python 就绪的，但它的时代可能已经过去了。

如果你有兴趣看的话，可以在这里得到: [`https://www.sublimetext.com/3`](https://www.sublimetext.com/3) 。

## 摘要

最后，您选择使用哪个编辑器并不重要。必须是你觉得舒服的事情。无论你选择什么，花时间掌握这个工具。如果你想富有成效，你必须掌握你每天必须使用的任何工具或流程，不管它看起来有多平凡。我的建议是你选择其中的一个来彻底学习，如果它不是 Vim 或 Emacs，至少学习足够的 Vim 来编辑其中的文本。这会让你花在服务器上编辑软件的时间变得更加愉快。

现在，您已经设置好了环境，并将其与系统的其余部分隔离开来。您也已经安装了您选择的编辑器并准备好了，所以让我们不要浪费任何时间。让我们开始看看一些实用的 Python 设计模式。