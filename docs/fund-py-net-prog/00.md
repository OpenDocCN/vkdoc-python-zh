# 零、简介

对于 Python 社区来说，这是一个激动人心的时刻。经过二十年的精心创新，这种语言在保持语法和概念简单的同时，获得了上下文管理器、生成器和理解等功能，Python 终于起飞了。

Python 不再被视为只能由谷歌和美国国家航空航天局(n as a)等顶级编程公司冒险开发的精品语言，而是正在被迅速采用，既包括传统的编程角色，如 web 应用设计，也包括“不情愿的程序员”的广阔世界，如科学家、数据专家和工程师——这些人学习编程不是为了编程本身，而是因为如果他们要在自己的领域取得进展，就必须编写程序。我认为，简单的编程语言为偶尔的或非专业的程序员提供的好处不能被夸大。

蟒蛇 3

在 2008 年首次亮相后，Python 3 经历了几年的修改和精简，才准备好扮演其前身的角色。但是随着它现在进入第二个五年，它已经成为 Python 社区中首选的创新平台。

无论是着眼于根本性的改进，如真正的 Unicode 文本现在是 Python 3 中的默认字符串类型，还是着眼于个别的改进，如正确支持 SSL，一个用于异步编程的内置`asyncio`框架，以及对大大小小的标准库模块的调整，Python 3 为网络程序员提供的平台几乎在各个方面都得到了改进。这是一项重大成就。Python 2 已经是让程序员在现代互联网上快速有效地工作的最佳语言之一。

这本书并不是从 Python 2 切换到 Python 3 的全面指南。它不会告诉您如何在旧的`print`语句中添加括号，将标准库模块导入重命名为新名称，或者调试有严重缺陷的网络代码，这些代码依赖于 Python 2 在字节字符串和 Unicode 字符串之间危险的自动转换——这些转换总是基于粗略的猜测。已经有很好的资源可以帮助您完成这种转变，甚至可以帮助您足够仔细地编写库，以便它们的代码可以在 Python 2 和 Python 3 下工作，以防您需要支持这两种受众。

相反，这本书侧重于网络编程，在 Python 提示符下，每个示例脚本和代码片段都使用 Python 3。这些例子旨在构建一幅全面的图像，说明如何利用该语言提供的工具最好地构建网络客户机、网络服务器和网络工具。读者可以通过将本书第二版每章中使用的脚本与第三版中的清单进行比较，来研究从 Python 2 到 Python 3 的过渡——这两个版本都可以在`https://github.com/brandon-rhodes/fopnp/tree/m/`获得，这要归功于在线提供源代码的优秀策略。接下来每一章的目标只是向您展示 Python 3 如何最好地用于解决现代网络编程问题。

通过直接关注如何用 Python 3 以正确的方式完成事情，这本书希望让准备从头开始编写新应用的程序员和准备将旧代码基础转换到新约定的程序员都做好准备。两位程序员都应该知道 Python 3 中正确的网络代码是什么样的，因此也应该知道他们的目标应该是什么样的代码。

此版本中的改进

除了将 Python 3 作为其目标语言，以及在过去五年中对标准库和第三方 Python 模块进行了许多更新之外，本书还尝试对之前的版本进行了一些改进。

*   每个 Python 程序清单现在都被写成一个模块。也就是说，每个模块执行其导入并定义其函数或类，然后小心地保护一个`if`语句中的任何导入时动作，该语句仅在模块`__name__`具有特殊字符串值`'__main__'`时触发，该字符串值表示该模块作为主程序运行。这是 Python 的最佳实践，在本书的前一版本中几乎完全被忽略了，它的缺失使得示例清单更难被引入真正的代码库并用于解决读者的问题。通过将可执行逻辑放在左边，而不是放在一个`if`语句中，旧的程序清单可能节省了一两行代码，但是它们给 Python 程序员新手提供的如何编排真正代码的练习要少得多。
*   本书中的大多数脚本现在使用标准库`argparse`模块来解释选项和参数，而不是专门使用原始的`sys.argv`字符串列表来解释命令行。这不仅阐明并记录了每个脚本在调用期间所期望的语义，还让每个脚本的用户在从 Windows 或 Unix 命令行启动脚本时使用`–h`或`--help`查询选项来获得交互式帮助。
*   程序清单现在通过在一个控制`with`语句中打开文件来努力执行适当的资源控制，当它完成时将自动关闭文件。在以前的版本中，大多数清单依赖于这样一个事实，即 Python 主网站上的 C Python 运行时通常会确保文件立即关闭，这要归功于它积极的引用计数。
*   这些清单在很大程度上已经过渡到了执行字符串插值的现代`format()`方法，并远离了旧的模运算符 hack `string % tuple`,这在 20 世纪 90 年代是有意义的，当时大多数程序员都知道 C 语言，但对于今天进入该领域的新程序员来说可读性较差——功能也较弱，因为单个 Python 类不能像使用新类型那样覆盖百分比格式。
*   关于 HTTP 和万维网的三章(第九章到第十一章)已经被从头开始重写，重点是更好地解释协议和介绍 Python 为程序员提供的最现代的工具。HTTP 协议的解释现在使用请求库作为执行客户端操作的 API，第十一章在 Flask 和 Django 中都有例子。
*   关于 SSL/TLS 的材料(第六章)已经完全重写，以匹配 Python 3 为安全应用提供的支持方面的巨大改进。虽然 Python 2 中的`ssl`模块是一个弱的折中方案，它甚至不能验证服务器的证书是否与 Python 所连接的主机名相匹配，但是 Python 3 中的相同模块提供了一个设计更加精心、更加广泛的 API，它提供了对其特性的大量控制。

因此，就如何构造清单和示例而言，即使不考虑 Python 3 对该语言以前版本的改进，本书的这个版本也是学习程序员的更好资源。

网络游乐场

本书中程序列表的源代码可以在网上获得，因此本书的当前所有者和潜在读者都可以研究它们。这本书的每一章都有目录。你可以在这里找到章节目录`:`

```py

https://github.com/brandon-rhodes/fopnp/tree/m/py3

```

但是程序清单对于支持好奇的网络编程学生来说只能到此为止。网络编程有许多特性很难在单台主机上探索。因此，本书的源代码库提供了一个由 12 台机器组成的示例网络，每台机器都实现为一个 Docker 容器。提供了一个安装脚本来构建映像、启动映像并将其联网。您可以在下面的源代码库中找到脚本和图像:

```py

https://github.com/brandon-rhodes/fopnp/tree/m/playground

```

在图 i-1 中可以看到 12 台机器以及它们的相互连接。这个网络被设计成一个微型的互联网。

![9781430258544_FM-01.jpg](img/9781430258544_FM-01.jpg)

图 1 网络游乐场的拓扑结构

*   代表客户在家中或咖啡店中的典型情况的是`modemA`和`modemB`后面的客户机，它们不仅不向互联网提供服务，而且实际上在更广泛的互联网上根本看不到。它们只拥有本地 IP 地址，这些地址只有在它们与同一家或咖啡店中的任何其它主机共享的子网上才有意义。当它们与外界建立连接时，这些连接看起来似乎来自调制解调器本身的 IP 地址。

*   直接连接允许调制解调器连接到更广阔的互联网上的一个`isp`网关，它由一个单独的`backbone`路由器代表，在它所连接的网络之间转发数据包。
*   `example.com`及其相关的机器代表一个简单的面向服务的机房的配置。这里，没有网络转换或伪装发生。`example.com`后面的三台服务器的服务端口完全暴露给来自互联网的客户端流量。
*   每台服务机器`ftp`、`mail`和`www`都已经正确地配置好守护进程并运行，因此本书中的 Python 脚本可以在操场上的其他机器上运行，以成功连接到每个服务的代表性示例。
*   所有的服务机器都已经正确安装了 TLS 证书(参见第六章)，并且客户端机器都已经安装了`example.com`签名证书作为可信证书。这意味着要求真正 TLS 认证的 Python 脚本将能够实现它

随着 Python 和 Docker 的不断发展，网络游乐场将继续得到维护。存储库中将保存如何在自己的机器上下载和运行网络的说明，并将根据用户报告进行调整，以确保提供操场的虚拟机可以由 Linux、Mac OS X 和 Windows 机器上的读者运行。

有了在任何一台游戏机器上连接和运行命令的能力，您将能够在网络上任何您希望看到客户机和服务器之间流量通过的地方设置数据包跟踪。文档中展示的示例代码，结合本书中的示例和说明，应该有助于您对网络如何帮助客户端和服务器通信有一个坚实而生动的理解。