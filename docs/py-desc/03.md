# 三、描述符有什么用？

这个世界上没有什么是完美的，Python 的描述符也不例外。描述符允许你做一些非常酷的事情，但是这些酷的事情是有代价的。在这里，我们讨论好的和坏的。

## Python 描述符的优点

显然，我们要回顾一下描述符的优点。如果它们不能被认为是好东西，会有一整本书来介绍它们吗？

### 包装

描述符最有用的一个方面是它们很好地封装了数据。使用描述符，您可以使用属性访问符号(`a.x`)以简单的方式访问属性，同时在后台执行更复杂的操作。例如，一个`Circle`类可能有半径、直径、周长和面积，就像它们是属性一样可用，但是因为它们都是链接的，所以您只需要存储一个(我们将使用半径作为例子)并基于它计算其他的。但是从外面看，它们都像存储在对象上的属性。

### 读/写模式的重用

通过使用专门的描述符，您可以重用用于读取和/或写入属性的代码。这些可以用于同一类中的重复属性或者其他类共享的属性类型。下面几节描述了一些可重用模式的例子。

#### 惰性实例化

您可以使用描述符定义一个非常简单的语法来延迟实例化一个属性。在本书的后面将会提供一个很好的惰性属性实现的代码。

在`Circle`示例中，非 radius 属性在使其缓存无效后，不需要立即计算它们的值；他们可以等到需要的时候。那是懒惰。

#### 确认

编写许多描述符只是为了确保传入的数据符合类或属性的不变量。这样的描述符通常也可以被设计成方便的装饰器。

再次以`Circle`为例:所有这些属性都应该是正数，所以所有的描述符也可以确保被设置的值是正数。

#### 触发动作

描述符可用于在访问属性时触发某些操作。例如，observer 模式可以在每个属性的意义上实现，以便在属性改变时触发对 observer 的调用。

最后一个`Circle`例子:所有的“属性”都是基于懒人计算的半径。为了避免每次都必须计算它们，您可以缓存结果。然后，只要其中一个发生变化，就会导致所有其他缓存失效。

### 为班级水平写作

因为描述符存储在类范围而不是实例范围，所以它允许您在类级别做更健壮的事情。例如，描述符使`classmethod`和`staticmethod`工作，这将在下一章解释。

## Python 描述符的缺点

尽管描述符很棒，但它们也是有代价的，就像编程中的其他事情一样。

### 包装

等等……封装是专业的。这怎么可能也是骗局呢？问题是你可以在看起来像属性使用的东西后面隐藏难以置信的复杂性。使用 getters 和 setters，用户至少可以看到有一个函数被调用，并且在一个函数调用中可以发生很多事情。但是用户不一定期望看似属性访问的事情也会导致其他事情的发生。大多数情况下，这不是问题，但它会妨碍用户尝试调试任何问题，因为*显然*代码不会是问题。

### 可能很难写

当考虑到描述符存储在类级别，但通常用于在实例级别处理属性的事实时，我们很容易陷入混乱。除此之外，在决定如何保存所表示的属性时，无论是在描述符上还是在属性所针对的对象上，都有许多需要考虑的事项和常见的陷阱要处理。描述符工具库就是为此而专门创建的。

### 附加对象

因为描述符添加了另一个间接/抽象层，它们还在内存中添加了至少一个额外的对象，以及至少一个额外的调用堆栈级别。在大多数情况下，两者都不止一个。这增加了膨胀，使用 getters 和 setters 至少可以部分减轻膨胀。

## 摘要

描述符是很棒的，它允许各种好的特性，这些特性可以很好地对代码的用户隐藏它们的复杂性，但是你一定要意识到这种能力是有代价的。