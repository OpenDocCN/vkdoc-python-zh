# 十二、用户定义的函数

用户定义的函数允许你打包和命名几行代码，并在整个程序中重用这些代码行。你所要做的就是调用你赋予你的函数的名字。

## 什么是函数？

Python 中的一个函数可以用来执行一个简单的任务，因此它只是一个助记符或给一组行的特殊名称。您还可以选择将值作为参数发送到函数中，或者从函数中返回值。一个函数只能返回一个值，但是这个值可以是一个元组。

## 函数的格式

下面的简单函数在被调用时显示“Hello world ”:

```py
def sayHello():
    print("Hello, world!")

sayHello()

```

使用 def 关键字定义函数。该函数由它的名称和括号“(”和“)”内的可选参数组成。

因为它是一个 Python 块，所以第一行以冒号结尾，组成块的行缩进一个制表符。

## 作为一个卑微的任务/记忆装置

简单来说，函数可以用作记忆或替换你将反复使用的多行代码。例如，如果您想要显示一个框，您可能想要使用如下内容:

```py
def drawBox():
    print("+--------+")
    print("|        |")
    print("+--------+")

drawBox()
print("Between two boxes")
drawBox()

```

这段代码的输出是

```py
+--------+
|        |
+--------+
Between two boxes
+--------+
|        |
+--------+

```

当我们想画一个盒子时，我们现在有了一致性。当我们调用 drawBox()时，每个盒子看起来都和其他盒子一样。

> *函数允许你重复使用代码*

这就是函数的力量:它们允许所谓的代码重用。代码重用意味着您可以在应用中多次使用同一个代码块。如果您出于任何原因需要更改该函数，任何调用它的代码都将获得更改后的版本。

函数的另一个目标是让你调用的地方更容易阅读。一个代码块应该执行一个任务，而不是多个任务。写程序的时候，要考虑这些断点应该出现在哪里。这些应该是你的功能。

例如，您被要求从键盘读入温度，并将它们写入文件，计算平均值、最大值和最小值，并将它们存储在单独的文件中。您可以编写名为

*   getTemperatures()

*   写入温度()

*   calcAverage()

*   calcMinimum()

*   calcMaximum()

*   writeStats()

然后这些将从主程序中以正确的顺序被调用。

## 发送参数

拥有一个可以在多个地方重复执行的代码块当然很好，但是有一点限制。如果每次调用它的时候都想改变一些值呢？参数(或自变量)可用于为您的函数提供更多信息。例如，您要绘制的框的宽度和高度。考虑以下函数:

```py
def drawBox(width, height):

```

drawBox()方法有两个参数:一个名为 width，另一个名为 height。这些参数从调用行传递到函数中(稍后会看到)。这些只是我们使用的名字，以便我们可以在函数体中以有意义的方式引用参数。

```py
    if width < 0:
        width = 3

```

这些框是在基于字符的显示器上绘制的，因此，我们可以拥有的最小宽度是三个字符；这是因为我们在每个角上使用“+”字符，并用“–”表示水平线。

```py
    if height < 3:
        height = 3

```

我们对身高也有类似的限制。我们的最小高度是三，因为我们必须有两条水平线和至少一条包含“|”、一些空格和“|”的线来表示盒子的垂直线。

```py
    width = width - 2

```

不管我们的宽度是多少，它都长了两个字符！这是因为每行都以“|”开始和结束。因此，字符数为宽度–2(两个“|”字符)。

```py
    print("+" + "-" * width + "+")

```

我们的顶行是固定的，因为它包含由“+”表示的角块。我们还使用 Python 方便的字符串算法来生成字符串行；“+”用于将两个字符串连接(相加)在一起，而“*”用于将一个字符串与一个数字相乘，以将一个字符重复一定的次数。

```py
    for y in range(3, height + 1):
        print("|" + " " * width + "|")

```

for 循环遍历从“3”到高度加 1 的每个值。请记住，范围是从起始值到比您想要的数字小一的值。同样，我们使用字符串算法来生成我们的行。

```py
    print("+" + "-" * width + "+")

```

我们通过画出盒子的底部来结束这个功能。

要调用该函数，您可以使用函数的名称，然后传入我们想要使用的参数:

```py
drawBox(5, 4)

```

您必须知道每个参数的用途，这就是为什么将参数命名为易于识别的名称是个好主意。在这个例子中，如果盒子的宽度是 5，高度是 4，那么它的输出将是

```py
+---+
|   |
|   |
+---+

```

## 默认参数值

可以指定每个参数的默认值。这意味着如果用户不想指定一个参数的值，他们不必这样做。假设我们想要默认宽度和高度为 3。将函数定义更改为

```py
def drawBox(width = 3, height = 3):

```

如果我们只是想要一个 3×3 的盒子，我们可以这样做:

```py
drawBox()

```

这会将默认值分配给宽度和高度。假设我们想要指定宽度而不指定高度。让我们创建一个 5×3 的矩形:

```py
drawBox(5)

```

默认值必须是传递给函数的最右边的参数。下列函数签名是有效的，因为第一个带有默认值的参数后面的所有参数也被赋予默认值:

```py
def drawBox(width, height = 10)
def drawSprite(sprite, width = 32, height = 32, transparency = 1)

```

以下函数签名无效:

```py
def drawBox(width = 5, height)
def drawSprite(sprite = None, width, height, transparency = 1)

```

带有默认值的参数后面的所有参数也必须有默认值！

### 命名参数

如果我们只是想要一个默认的宽度，但是我们想要指定一个高度呢？这很简单；只需传入您想要为其指定值的参数的名称:

```py
drawBox(height = 10)

```

这会画出一个 3×10 的盒子。宽度将默认为 3，因为它没有被赋值。这种技术称为命名参数，允许您通过名称指定参数。在其他语言中，可选参数(具有默认值的参数)必须放在参数列表的末尾。在 Python 中，可以使用命名参数来指定全部或部分可选参数。

## 返回值

函数的主要用途之一是从提供的参数生成新值。让我们先来看一个微不足道的例子，将两个数字相加:

```py
def add(first, second):
    return first + second

print(add(10, 5))

```

该函数通常用“def”关键字和函数名来定义。该函数有两个参数“第一”和“第二”

组成函数体的唯一一行是

```py
return num1 + num2

```

“return”关键字获取其右侧的任何值，并将其传递回调用行。在我们的示例中，调用行是以下打印语句:

```py
print(add(10, 5))

```

“第一个”被赋值为 10，“第二个”被赋值为 5。两者相加后返回。然后“print”关键字显示返回值。因为它是一个整数值，所以这是一个微不足道的任务，它只显示结果:

```py
15

```

但是我们可以添加的不仅仅是整数值:

```py
print(add('sloan ', 'kelly'))
print(add(3.14, 1.61))
print(add((1,2,3), (4,5,6)))

```

我们能加在一起的任何东西都可以使用这个功能。我们已经看到，Python 将从函数中返回我们想要的任何东西，这可能取决于传递的参数值是如何确定的。

### 返回元组

元组可以作为完整的元组返回，也可以作为单独的元素值返回。在下面的示例中，元组被返回并打印到屏幕上:

```py
def getPlayerPosition():
    return (10, 5)
print (getPlayerPosition())

```

输出是

```py
(10, 5)

```

我们还可以在调用函数时将元组分解成单独的变量，例如:

```py
def getPlayerPosition():
    return (10, 5)

x, y = getPlayerPosition()

print ("Player x is", x)
print ("Player y is", y)

```

这将显示

```py
Player x is 10
Player y is 5

```

## 访问全局变量

全局变量通常被认为是糟糕的编程实践。

它们会导致代码中的错误或 bug，因为跟踪每个全局变量何时被访问(值被读取)以及每次被更改(值被写入)都需要时间。

函数可以毫无问题地读取全局变量，如下例所示:

```py
num = 5
def printNum():
    print(num)

printNum()

```

如果我们改变函数内部的值呢？然后会发生什么？

```py
num = 5
def changeNum():
    num = 10

print(num)
changeNum()
print(num)

```

现在，输出是

```py
5
5

```

为什么会这样呢？嗯，为了防止不好的事情在你的程序中发生，Python 有一个防故障技术来防止全局值被写入，除非你明确地说它们可以被写入。要在函数中将变量标记为“可写”,请添加 global 和全局变量的名称，如下所示:

```py
num = 5
def changeNum():
    global num
    num = 10

print(num)
changeNum()
print(num)

```

添加了 global 关键字和全局变量的名称后，对 printNum 中“num”全局变量的任何更改都将被应用。该程序的输出现在将是

```py
5
10

```

## 函数的真实示例

函数可以包含自己的变量。这些变量被称为函数的局部变量。它们不能被功能之外的任何东西看到或操纵。变量的这种隐藏被称为变量作用域。我们已经看到，全局变量可以在任何地方访问。对于局部变量，它们只对函数可见，并且只在函数执行时存在。

我们可以为砖块游戏重写一些代码来使用函数。我将把它作为一个练习，让读者将代码的其他部分转换成函数。我们将创建一个函数来加载砖块图像并设置砖块位置。

打开包含“砖块”游戏代码的 Python 文件。现在，您的代码应该有一个类似这样的区域:

```py
# brick init
brick = pygame.image.load('brick.png')
bricks = []
for y in range(5):
    brickY = (y * 24) + 100
    for x in range(10):
        brickX = (x * 31) + 245
        width = brick.get_width()
        height = brick.get_height()
        rect = Rect(brickX, brickY, width, height)
        bricks.append(rect)

```

拆下管路

```py
brick = pygame.image.load('brick.png')

```

并替换为

```py
brick = None

```

将剩余的几行改为

```py
def createBricks(pathToImg, rows, cols):
    global brick

```

该函数将接受三个参数。第一个是我们将用来画砖的图像文件的路径。第二个和第三个参数是我们想要的砖块的行数和列数。我们的砖块位置存储在名为“砖块”的列表中，图像名为“砖块”我们将在名为 brick 的文件顶部创建一个全局变量。这保持了我们对砖块的印象。

```py
    brick = pygame.image.load(pathToImg)
    bricks = []
    for y in range(rows):
        brickY = (y * 24) + 100
        for x in range(cols):
            brickX = (x * 31) + 245
            width = brick.get_width()
            height = brick.get_height()
            rect = Rect(brickX, brickY, width, height)
            bricks.append(rect)
    return bricks

```

现在，向下滚动到主循环开始处的这一行之前:

现在将这一行添加到“while True”的正上方:

```py
bricks = createBricks('brick.png', 5, 10)

```

我们将砖块数据列表直接返回到我们的“砖块”变量中。这意味着我们不需要更早地创建一个变量，也不需要在函数中添加一个全局行。

> 谨慎使用全局变量！

全局变量可以而且应该避免，我们将在本书中看到如何避免。与其现在教那些技术，把水搅浑，不如让这种违规溜走，享受我们的第一场比赛！

保存并运行游戏。它应该像以前一样工作，但酷的是现在你可以很容易地改变砖的行数和列数，只需改变传递给“createBricks”的参数

## 结论

在本章中，我们探索了代码重用的第一个 Python 例子:函数。函数允许我们编写执行单一任务的宏程序，例如，显示精灵、保存游戏或设置游戏屏幕。

通过给函数名后括号中列出的形式变量(参数)赋值，可以向函数传递附加信息。每个参数都应该有一个名称来描述它们的用途，例如，“playerData”、“width”、“enemySprite”等。

有时函数并不需要所有的参数，您可以为每个参数添加默认值。如果有多个默认值，而您只想指定一个或两个值，那么在调用函数时也可以指定一个命名参数。