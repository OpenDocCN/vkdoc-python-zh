# 一、Db2 简介

欢迎学习 Db2 简介。既然您在这里，那么您可能正在寻找开始使用 Db2 的地方。我们希望这本书将是你寻找第一步。这本书旨在介绍 Db2 环境和 Python 接口。本书的前半部分将在管理员和程序员都感兴趣的水平上介绍 Db2。它将涵盖您将在这两个角色中使用的 Db2 的许多方面。本书的后半部分将集中讨论如何使用 Python 编程语言与 Db2 接口。虽然主要面向程序员，但管理员也会发现它对他们的一些日常任务也很有用。

Db2 历史悠久，是第一个关系数据库实现。它最初是由 Edgar Frank“Ted”Codd 在 1969 年的一篇题为“大型共享数据库的数据关系模型”的论文中提出的，当时他在 IBM 位于加利福尼亚的圣何塞研究实验室工作。在接下来的四年中，IBM 研究人员致力于创建一个基于 Codd 论文中描述的原则的系统(称为 System R)。在此期间，显然需要一种新的语言来与新的系统进行交互。Codd 写了一篇新论文“一种基于关系演算的数据库子语言”，它成为了称为 DSL/Alpha 的新语言的基础。这很快经历了一些名称的变化，但最终被称为 SQL，结构化查询语言的缩写。

最终，在 20 世纪 70 年代，有人尝试将 DSL/Alpha 移植到 370 大型机环境中。它在 1982 年被重新命名为数据库 2。第二年，它以另一个名字 DB2 对公众开放。这是一个有限的版本，但是受到了客户的高度评价。客户实际上推动 IBM 向更广泛的客户提供 DB2。IBM 有些不情愿，因为他们试图保住他们的 IMS/DB 市场份额。但是最终客户赢了，DB2 开始扩展到其他平台，包括 OS/2、AIX/RS6000 和 Windows。

在接下来的二十年里，该产品经历了多次名称变更和几个平台代码库。最近，随着 11.1 版本的发布，IBM 重塑了整个产品线，并将代码库合并到少量代码库中。以下一组产品现在是标准产品:

*   Db2(以前的 DB2 LUW)

*   Db2 for z/OS(以前的 DB2 for z/OS)

*   Db2 托管(以前称为云上的 DB2)

*   云上的 Db2(以前是事务的 dashDB)

*   Db2 事件存储(一个新的用于事件驱动事务处理的内存数据库)

*   云上的 Db2 仓库(以前称为 dashDB)

*   Db2 仓库(以前是 dashDB Local)

*   IBM Integrated Analytics System(一个新的系统平台，结合了 IBM PureData 系统和 IBM Netezza 的分析性能和功能)

今天的 Db2 产品的代码库共享一个公共的代码库，这使得将代码移植到另一个硬件/软件平台成为一个相对容易的过程。SQL 代码库已经过标准化，因此在所有平台上都是相同的，从编程的角度来看，迁移到另一个平台是一件容易的事情。

使用嵌入式 SQL 编写应用也是当前的趋势。如果不对代码进行重大修改，这些类型的应用很难从一个平台移植到另一个平台。相反，IBM 正在(在可能的情况下)转向一种 API，可以调用该 API 来处理 SQL 语句，并利用编程语言变量将值添加到 SQL 语句中。这是用于 Python 的方法，我们将在本书的后面探讨。

过去，Db2 被认为对于大多数应用来说太大了。但是随着个人计算机变得越来越强大，然后即使是很少的人使用的数据库也变得非常大，Db2 在管理这些数据方面变得越来越有吸引力。此外，这些平台上 Db2 的定价模型变得更有竞争力。因此，如果您需要管理大量数据的性能和能力，Db2 可能是一个非常有吸引力的产品。

## 什么是关系数据库？

关系数据库实际上很难定义，因为在今天的市场上没有关系数据库系统真正实现 E. F. Codd 定义关系模型的 12 条规则。相反，商业关系数据库只实现了其中的七到九条规则。这足以使他们的产品在商业上有用，而不必承担执行其他规则的负担。事实上，其他规则对大多数数据库用户没有用，所以它们是否能在商业产品中实现还是个问题。事实上，大多数商业数据库供应商实际上是通过添加不是真正的表的实体来扩展关系模型的，比如 BLOBs(我们将在后面讨论)。

### 关系模型

粗略地说，关系数据库实现了用行和列表示的实体的概念。客户记录表中有一行代表一个客户。表的列(或元组)将包含该客户的属性。每一列都包含一个属性，并有一个定义的数据类型来限制它可以包含的信息类型。典型的客户地址表可以如表 1-1 所示实现。

表 1-1

示例客户表

<colgroup><col class="tcol1 align-left"> <col class="tcol2 align-left"> <col class="tcol3 align-left"> <col class="tcol4 align-left"> <col class="tcol5 align-left"> <col class="tcol6 align-left"></colgroup> 
| 

断续器

 | 

姓氏

 | 

LNAME

 | 

街道

 | 

状态

 | 

活力

 |
| --- | --- | --- | --- | --- | --- |
| 000000001 | 疯狂的 | 兔子 | 鲁尼巷 1201 号 | 加利福尼亚 | Seventy-seven thousand seven hundred and seventy-seven |
| 000000002 | 马文 | 火星人 | 2342 年 3 月大道 | 马萨诸塞州 | Thirty thousand one hundred and forty-three |
| 000000003 | 疯狂的 | 杜克 | 白蚁梯田 5462 号 | 加利福尼亚 | Seventy-seven thousand seven hundred and forty-five |
| 000000004 | 埃尔默（Aylmer 的异体）（m.） | Fudd | 亨特湾 23 号 | 加利福尼亚 | Seventy-seven thousand seven hundred and thirty-two |

这个表是一个很好的例子，因为它显示了可以在关系数据库中表达的关系类型。CUSTNO 列为每个客户(或行)保存一个唯一的客户号。该列是该表的主键。FNAME 和 LNAME 标识客户的名和姓。街道是用于给客户开账单的地址。州列是地址所在的美国州。邮政编码列标识邮寄邮政编码。

### 域

域(或属性)将列中的数据限制为特定类型。例如，数据可能是特定类型的整数、货币值、固定或可变长度的字符串、日期或时间值，或者已经定义的一些其他域。

### 键和索引

表 1-1 中的 STATE 列是外键——即另一个表中的主键。可以设置一个规则，以便当您向 customer 表中添加一个新行时，系统检查您的 proposed STATE 字段中的值是否是 STATE 表中的一个有效条目。如果不是，则不会插入记录，并且会生成一个错误。键也称为索引。在表中创建主键时，会创建一个特殊的索引表来保存有效的键。该表类似于系统中的任何其他表；可以对其进行查询、添加和删除。因此，所有有效的键都可以插入到表中并在表中进行维护，并且可以像任何其他表一样进行维护。只有特殊的规则才能使索引表变得特殊。

### 关系

所有这些仅仅展示了可以创建(或派生)来正确维护一组表的一些关系。可能还会创建其他类型的客户表，如维护客户信用评级的表、客户送货地址表、客户联系人表等。所有这些都是与其他客户表有关系的专门化实体。这就是关系数据库的全部内容。这个想法是表达一种与数据组织的关系，所以数据只存储在需要的地方，希望只存储一次。

关系允许用户创建定制的报告，这些报告可以表达来自数据库的数据的定制视图。乍一看，这些报告可能看起来与数据库中包含的数据没有关系，但它们可以提供通过其他方式不容易实现的数据洞察力。

### 处理

关系数据库的另一个方面是支持事务。这意味着提供一种锁定机制，允许在其他人读取数据或修改其他数据的同时修改数据。这就是所谓的酸性测试，是以下测试的缩写:

*   原子性定义了组成完整数据库事务的所有元素。这可能构成一个或多个 SQL 语句。

*   一致性定义了在事务处理后将数据点保持在正确状态的规则。这通常是通过一个 SQL 语句完成的，比如 COMMIT 或 ROLLBACK。

*   隔离使事务的效果在提交之前对其他人不可见，以避免混淆。这是指数据库防止对数据库的多次更改破坏数据库完整性的能力。

*   持久性确保一旦提交事务，数据更改就变成永久的。这是通过确保在提交事务之前对所有已修改的表进行写入来实现的。

### 存储过程

关系数据库通常实现存储过程。这些是存储在数据库中的程序，用于在几种情况下实现特殊处理。这些过程通常涉及业务逻辑，需要在所有数据库用户中实现相同的业务逻辑。在许多情况下，只有存储过程具有修改、插入、删除或访问被操作数据的适当权限。这可以防止用户在没有正确权限的情况下修改数据。

### 限制

关系数据库的另一个特性是约束。这些使得进一步限制属性成为可能。例如，一个列可能被定义为一个整数。但是数字的范围实际上可能需要被限制在一个特定的范围内。这就是约束所提供的。

约束可以有多种形式，并有多种用途。它们存储在数据库中，在添加或修改数据时使用。

### 正常化

规范化是关系数据库的另一个属性。这种设计过程减少了非原子值的数量和数据库中的重复数据，从而防止了异常和完整性的损失。这个过程被称为规范化。

规范化过程通常由管理员在创建数据库的过程中执行。用户通常不参与此活动。

## 结构化查询语言

在创建第一个关系数据库的最初几年里，很明显需要某种东西来实际操作关系数据库中的数据。这种语言是由 IBM 的唐纳德·d·钱伯林和雷蒙德·f·博伊斯在 20 世纪 70 年代早期发明的。它最初被称为 SEQUEL，但是这个名字被注册了商标，并被改为结构化查询语言(SQL)。SQL 后来被 ANSI 标准化了，但是每个关系数据库产品都根据需要对其进行了扩展，以符合它们的产品或硬件平台。

SQL 分为四类语句:

*   数据定义语言

*   数据查询语言(DQL)

*   数据控制语言

*   数据操作语言

大多数 SQL 书籍将大部分资源花在 SQL 的 DML 部分，但其他部分也同样重要，尤其是对数据库管理员而言。

### 数据定义语言

数据定义语言子集由 CREATE、DROP、ALTER 和 TRUNCATE 语句组成。这些语句操作(或重新组织)数据库中的数据。

CREATE 语句在数据库中创建新实体。这可以包括表、索引、视图和过程。许多数据库系统也包括字符集、排序规则、事务和断言。

DROP 语句从数据库中删除实体。这些包括可以用 CREATE 语句创建的所有实体。一些数据库将用户作为一个可以删除的实体。

ALTER 语句可以改变现有实体，例如向表中添加新列。

TRUNCATE 语句从表或索引中删除所有数据。它比 DELETE SQL 语句快得多。

### 数据查询语言(DQL)

数据查询语言子集仅由 SELECT 语句组成。这用于数据库中的所有信息查询。SELECT 语句的语法将在第七章中介绍。

### 数据控制语言

数据控制语言子集由 GRANT 和 REVOKE 语句组成。这些语句授予和撤销数据库用户的权限。数据库系统指定可以授予用户的特权类型。一些数据库系统，如 SQLite，依赖于操作系统的特权机制，因此不支持 GRANT 和 REVOKE 语句。

### 数据操作语言

数据操作语言子集由 INSERT、UPDATE 和 DELETE 语句组成。有些系统还在这个子集中包含 SELECT 语句，但是由于 SELECT 不会对数据进行更改，所以将 SELECT 语句放在这里似乎有些奇怪。

INSERT 语句向表中添加新行。这个新数据也可以自动改变表格数据视图的内容。

UPDATE 语句改变现有表(以及依赖于该表的任何视图)中的一行或多行。该语句不会向表中添加新行，它只会改变现有数据。

DELETE 语句从表(以及依赖于该表的任何视图)中删除行。

## ibm_db 项目

`ibm_db`项目开始于 2007 年的某个时候，2008 年 2 月 9 日向 GitHub 提交了第一份代码。该项目是 IBM 和 Python 社区共同努力的结果，目的是创建一个从 Python 到 Db2 和 Informix 的编程接口。大约在同一时间，Informix 被 IBM 收购，这是将 Informix 集成到 Db2 产品线项目的一部分。从那时起，该项目经历了稳步进展，最近进行了一些重大修复。

通过在 GitHub 上建立项目，人们认为在社区的支持下，项目不仅会随着时间的推移而改进，而且会从社区的参与中受益。事实证明，在项目的整个生命周期中，许多社区志愿者都为项目做出了贡献。

随着时间的推移，`ibm_db_dbi`模块被添加到项目中，并且基于`ibm_db`模块引入了新的项目来支持其他 Python 项目。这些项目包括`ibm_db_django`、`ibm_db_alembic`、`ibm_db_sa`。

有关更多信息，请参见第八章。

## 摘要

本章介绍了构成关系数据库的一些基本概念以及支持关系数据库的 SQL。几乎所有的关系数据库都有这种信息。