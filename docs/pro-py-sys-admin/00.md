# 零、简介

这些年来，系统管理员的角色已经大大增加了。单个工程师支持的系统数量也增加了。因此，手工制作每个安装是不切实际的，需要尽可能多地自动化任务。系统的结构因组织而异，因此系统管理员必须能够创建自己的管理工具。历史上，用于这些任务的最流行的编程语言是 UNIX shell 和 Perl。它们很好地实现了自己的目的，我怀疑它们是否会不复存在。然而，当前系统的复杂性需要新的工具，Python 编程语言就是其中之一。

Python 是一种面向对象的编程语言，适合开发大规模应用。它的语法和结构使它非常容易阅读——以至于这种语言有时被称为“可执行伪代码”Python 解释器允许交互式执行，因此在某些情况下，管理员可以使用它来代替标准的 UNIX shell。尽管 Python 主要是一种面向对象的语言，但它很容易被用于过程式和函数式编程。综上所述，Python 非常适合作为实现系统管理应用的新语言。已经有大量的 Linux 系统工具是用 Python 编写的，比如 Yum 包管理器和 Anaconda，Linux 安装程序。

使用这本书的先决条件

这本书是关于使用 Python 编程语言来解决特定的系统管理任务。我们着眼于四个不同的系统管理领域:网络管理、web 服务器和 web 应用管理、数据库系统管理和系统监控。虽然我详细解释了本书中使用的大部分技术，但请记住，这里的主要目标是展示 Python 库的实际应用，以便解决相当具体的问题。因此，我假设您是一位经验丰富的系统管理员。你应该能够自己找到额外的信息；这本书给了你一个粗略的指导，告诉你如何达到你的目标，但是你必须能够想出如何使它适应你的特定系统和环境。

在我们讨论示例时，会要求您安装额外的包和库。在大多数情况下，我提供了在 Fedora 系统上执行这些任务的命令和指令，但是您应该准备好在您将要使用的 Linux 发行版中采用这些指令。大多数例子也可以在最近的 OS X 版本(10.10.X)上运行，不需要太多修改。

我还假设您有 Python 编程语言的背景。我介绍了系统管理任务中使用的特定库，以及一些鲜为人知或很少讨论的语言功能，如生成器函数或类内部方法，但这里没有解释基本的语言语法。如果你想刷新你的 Python 技能，我推荐以下几本书:*Marty al chin 和 J. Burton Browning 的 Pro Python*(a press，2012；但请关注将于 2015 年初发布的新版本)；*Mike Dawson 为绝对初学者编写的 Python 编程*(课程技术 PTR，2010)；以及 Wesley Chun 的*核心 Python 应用编程*

本书中的所有例子都假设 Python 版本为 2.7。这主要是由示例中使用的库决定的。部分库已经移植到 Python 3；然而，有些人没有。因此，如果您需要运行 Python 3，请确保检查所需的库是否支持 Python 3。

这本书的结构

这本书包含 14 章，每章解决一个独特的问题。有些例子跨越了多个章节，但即使这样，每章都处理特定问题的一个特定方面。

除了这些章节，这本书还有其他几个组织层次。首先，我根据问题类型对章节进行了分组。第一章到第四章处理网络管理问题；第五章到第七章讲的是 Apache web 服务器和 web 应用管理；第八章至 11 章专门用于监控和统计计算；而第十二章和第十三章关注的是数据库管理问题。

第二，我在所有章节中保持一个共同的模式。我从问题陈述开始，然后继续收集需求，在进入实现部分之前继续设计阶段。

第三，每章关注一种或多种技术以及为特定技术提供语言接口的 Python 库。这种技术的例子可以是 SOAP 协议、应用插件架构或云计算概念。

更具体地说，以下是各章节的分类:

第一章:使用 SNMP 读取和收集性能数据

大多数网络连接设备通过简单网络管理协议(SNMP)公开内部计数器。本章解释了 SNMP 的基本原理和数据结构。然后我们看一下 Python 库，这些库为支持 SNMP 的设备提供了接口。我们还研究了循环数据库，它是存储统计数据的事实上的标准。最后，我们看看 Jinja2 模板框架，它允许我们生成简单的 web 页面。

第二章:使用 SOAP API 管理设备

复杂的任务，如管理设备配置，不能通过使用 SNMP 轻易完成，因为该协议过于简单。因此，高级设备(如 Citrix Netscaler 负载平衡器)为设备管理系统提供 SOAP API 接口。在这一章中，我们研究了 SOAP API 结构和支持 Python 编程语言中基于 SOAP 的通信的库。我们还将使用内置的库来查看基本的日志功能。这本书的第二版包含了如何使用新的 REST API 来管理负载平衡器设备的例子。

第三章:创建一个用于 IP 地址统计的 Web 应用

在这一章中，我们将构建一个 web 应用来维护分配的 IP 地址和地址范围的列表。我们学习如何使用 Django 框架创建 web 应用。我将向您展示 Django 应用的构造方式，告诉您如何创建和配置应用设置，并解释 URL 结构。我们还研究了如何使用 Apache web 服务器部署 Django 应用。

第四章:集成 IP 地址应用和 DHCP

本章是对前一章的扩展，我们实现了 DHCP 地址范围支持。我们还研究了一些高级 Django 编程技术，比如定制响应 MIME 类型和服务 AJAX 调用。第二版增加了使用 OMAPI 协议管理动态 DHCP 租约的新功能。

第五章:在 Apache 配置文件中维护虚拟主机列表

这是我们在本书中开发的另一个 Django 应用，但是这次我们的重点是 Django 管理接口。在构建 Apache 配置管理应用时，您学习了如何用自己的视图和函数定制默认的 Django 管理界面。

第六章:从 Apache 日志文件中收集和显示统计数据

在本章中，我们的目标是构建一个解析和分析 Apache web 服务器日志文件的应用。我们没有采用构建单一应用这种简单但不灵活的方法，而是着眼于构建插件应用所涉及的设计原则。您将学习如何使用对象和类类型发现功能，以及如何执行动态模块加载。本书的第二版向您展示了如何基于收集的数据执行数据可视化。

第七章:执行复杂的搜索并报告应用日志文件

本章还涉及日志文件解析，但这次我将向您展示如何解析复杂的多行日志文件条目。我们研究了名为 Exctractor 的开源日志文件解析工具的功能，您可以从[`exctractor.sourceforge.net/`](http://exctractor.sourceforge.net/)下载。

第八章:Nagios 的网站可用性检查脚本

Nagios 是最流行的开源监控系统之一，因为它的模块化结构允许用户实现自己的检查脚本，从而定制工具来满足他们的需求。在这一章中，我们创建了两个检查网站功能的脚本。我们研究如何使用美汤 HTML 解析库从 HTML 网页中提取信息。

第九章:管理监控子系统

本章是三章系列的开始，在这一系列中，我们将构建一个完整的监控系统。本章的目标不是取代成熟的监控系统，如 Nagios 或 Zenoss，而是展示分布式应用编程的基本原则。我们着眼于数据库设计原则，如数据规范化。我们还研究了如何使用 RPC 调用实现网络服务之间的通信机制。

第十章:远程监控代理

这是监视系列的第二章，我们将实现远程监视代理组件。在本章中，我还描述了如何使用 ConfigParser 模块将应用从其配置中分离出来。

第十一章:统计数据收集和报告

这是监控系列的最后一部分，我将向您展示如何对收集的性能数据执行基本的统计分析。我们使用科学库:NumPy 执行计算，matplotlib 创建图形。您将学习如何发现哪些性能读数属于舒适区，以及如何计算该区域的边界。我们还进行基本的趋势检测，这为容量规划提供了很好的洞察力。

第十二章:分布式消息处理系统

这是本书第二版的新章节。在这一章中，我将向您展示如何使用远程任务执行框架 Celery 来转换分布式管理系统。

第十三章【MySQL 数据库性能自动调优

在本章中，我将向您展示如何获取 MySQL 数据库的配置变量和内部状态指示器。我们构建了一个应用，该应用根据获得的数据就如何提高数据库引擎性能提出建议。

第十四章:亚马逊 EC2/S3 作为数据仓库解决方案

本章向您展示了如何利用 Amazon 弹性计算云(EC2)并将不常见的计算任务卸载给它。我们构建了一个自动创建数据库服务器的应用，您可以在其中传输数据以供进一步分析。您可以使用这个示例作为构建随需应变数据仓库解决方案的基础。

**示例源代码**

本书中所有示例的源代码，以及任何适用的样本数据，都可以按照[www.apress.com/source-code/](http://www.apress.com/source-code/)的说明从 Apress 网站下载。存储在该位置的源代码包含书中描述的相同代码。

本书中描述的大多数原型也可以作为开源项目获得。你可以在作者的网站找到这些项目，[`www.sysadminpy.com/`](http://www.sysadminpy.com/)。